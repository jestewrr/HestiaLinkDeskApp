@page "/hr/attendance"
@using HestiaLink.Data
@using HestiaLink.Models
@using Microsoft.EntityFrameworkCore
@using AttendanceModel = HestiaLink.Models.Attendance
@inject HestiaLinkContext Context
@inject NavigationManager Navigation
@inject IJSRuntime JSRuntime
@layout MainLayout

<div class="page-wrapper">
    <header class="page-topbar">
        <h1>Attendance Management</h1>
        <span class="page-topbar-subtitle">@SelectedDate.ToString("dddd, MMMM dd, yyyy")</span>
    </header>

    <!-- Simple Toolbar - Same as EmployeeManagement -->
    <div class="user-toolbar">
        <div class="toolbar-left">
            <div class="toolbar-search">
                <input type="text" placeholder="Search by name, ID, or department..." 
                       @bind="SearchText" @oninput="OnSearchChanged" />
                <span class="search-icon"></span>
            </div>
            <input type="date" class="filter-select" value="@SelectedDate.ToString("yyyy-MM-dd")" 
                   style="padding: 10px 16px;" @onchange="OnDateChanged" />
        </div>
        <div>
            <button class="btn-primary" @onclick="LoadToday">Today</button>
        </div>
    </div>

    <!-- Summary Cards -->
    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin: 20px 0 30px 0;">
        <div class="stat-card">
            <div class="stat-title">Present Today</div>
            <div class="stat-value" style="color: #047857;">@PresentCount</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Absent Today</div>
            <div class="stat-value" style="color: #991b1b;">@AbsentCount</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">On Leave</div>
            <div class="stat-value" style="color: #d97706;">@OnLeaveCount</div>
        </div>
        <div class="stat-card">
            <div class="stat-title">Late</div>
            <div class="stat-value" style="color: #b91c1c;">@LateCount</div>
        </div>
    </div>

    <!-- Employee Table -->
    @if (!IsLoaded)
    {
        <div class="loading">Loading attendance records...</div>
    }
    else if (HasError)
    {
        <div class="error-message">
            <h4>⚠️ Database Error</h4>
            <p>@ErrorMessage</p>
            <button class="btn-primary" @onclick="RetryLoad">Retry</button>
        </div>
    }
    else
    {
        <div class="panel-card">
            <div class="panel-body user-list-container">
                @if (FilteredEmployees.Any())
                {
                    <table class="user-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Department</th>
                                <th>Shift</th>
                                <th>Check In</th>
                                <th>Check Out</th>
                                <th>Hours</th>
                                <th>Status</th>
                                <th style="text-align:center;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var emp in FilteredEmployees)
                            {
                                var schedule = ScheduleRecords.FirstOrDefault(s => s.EmployeeID == emp.EmployeeID);
                                var attendance = AttendanceRecords.FirstOrDefault(a => a.EmployeeID == emp.EmployeeID);
                                var isLate = IsEmployeeLate(attendance, schedule);
                                
                                <tr>
                                    <td style="font-family:monospace; font-weight:700;">@emp.EmployeeID</td>
                                    <td style="font-weight:600;">@emp.FirstName @emp.LastName</td>
                                    <td>@(emp.Position?.Department?.DepartmentName ?? "-")</td>
                                    <td>
                                        @if (schedule != null)
                                        {
                                            <div>
                                                <span class="shift-badge @GetShiftClass(schedule.ScheduledStart.Hours)">
                                                    @GetShiftName(schedule.ScheduledStart.Hours)
                                                </span>
                                                <div style="font-size:0.75rem; color:#64748b; margin-top:2px;">
                                                    @FormatTime(schedule.ScheduledStart) - @FormatTime(schedule.ScheduledEnd)
                                                </div>
                                            </div>
                                        }
                                        else
                                        {
                                            <button class="btn-secondary" style="padding:4px 10px; font-size:0.8rem;" 
                                                    @onclick="() => OpenShiftModal(emp, null)">
                                                + Assign Shift
                                            </button>
                                        }
                                    </td>
                                    <td>
                                        @if (attendance?.ActualCheckIn.HasValue == true)
                                        {
                                            <span style="color: @(isLate ? "#b91c1c" : "#10b981"); font-weight:700;">
                                                @attendance.ActualCheckIn.Value.ToString("hh:mm tt")
                                                @if (isLate)
                                                {
                                                    <span style="font-size:0.7rem; margin-left:2px;">(Late)</span>
                                                }
                                            </span>
                                        }
                                        else if (schedule != null)
                                        {
                                            <button class="btn-checkin" @onclick="() => CheckIn(emp, schedule)">
                                                ✓ Check In
                                            </button>
                                        }
                                        else
                                        {
                                            <span style="color:#94a3b8;">--:--</span>
                                        }
                                    </td>
                                    <td>
                                        @if (attendance?.ActualCheckOut.HasValue == true)
                                        {
                                            <span style="color:#f59e0b; font-weight:700;">
                                                @attendance.ActualCheckOut.Value.ToString("hh:mm tt")
                                            </span>
                                        }
                                        else if (attendance?.ActualCheckIn.HasValue == true)
                                        {
                                            <button class="btn-checkout" @onclick="() => CheckOut(attendance)">
                                                ✗ Check Out
                                            </button>
                                        }
                                        else
                                        {
                                            <span style="color:#94a3b8;">--:--</span>
                                        }
                                    </td>
                                    <td style="font-weight:700; color:#10b981;">
                                        @if (attendance != null)
                                        {
                                            @((attendance.RegularHours + attendance.OvertimeHours).ToString("F1"))<span style="font-weight:400;">h</span>
                                        }
                                        else
                                        {
                                            <span style="color:#94a3b8;">0.0h</span>
                                        }
                                    </td>
                                    <td>
                                        <span class="status-badge status-@GetStatusClass(attendance, schedule)">
                                            @GetStatusText(attendance, schedule)
                                        </span>
                                    </td>
                                    <td style="text-align:center;">
                                        <div style="display:flex; gap:6px; justify-content:center;">
                                            @if (schedule != null)
                                            {
                                                <button class="btn-icon btn-edit" title="Edit Shift" 
                                                        @onclick="() => OpenShiftModal(emp, schedule)">
                                                    ✏️
                                                </button>
                                            }
                                            <button class="btn-icon btn-history" title="View History" 
                                                    @onclick="() => ViewHistory(emp.EmployeeID)">
                                                📋
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <div class="no-data">No employees found</div>
                }
            </div>
        </div>
    }
</div>

<!-- Shift Assignment Modal -->
@if (ShowShiftModal)
{
    <div class="modal-overlay" @onclick="CloseShiftModal">
        <div class="modal-content" style="max-width:480px;" @onclick:stopPropagation="true">
            <div class="modal-header-teal">
                <h2 style="margin:0; font-size:1.3rem;">@(IsEditingShift ? "Edit Shift" : "Assign Shift")</h2>
            </div>
            
            <div style="padding:24px;">
                <div style="margin-bottom:20px; padding:14px; background:#f0fdfa; border:1px solid #99f6e4; border-radius:8px;">
                    <div style="font-weight:700; color:#0f766e;">@ModalEmployeeName</div>
                    <div style="font-size:0.85rem; color:#64748b;">@ModalEmployeeDept • @SelectedDate.ToString("MMM dd, yyyy")</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Shift Type</label>
                    <select class="form-input" @bind="SelectedShiftType" @bind:after="OnShiftTypeChanged">
                        <option value="">-- Select Shift --</option>
                        <option value="Day">🌅 Day Shift (5:00 AM - 5:00 PM)</option>
                        <option value="Night">🌙 Night Shift (5:00 PM - 5:00 AM)</option>
                        <option value="Custom">⚙️ Custom Schedule</option>
                    </select>
                </div>
                
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:16px;">
                    <div class="form-group">
                        <label class="form-label">Start Time</label>
                        <input type="time" class="form-input" @bind="ShiftStartTime" 
                               disabled="@(SelectedShiftType != "Custom" && !string.IsNullOrEmpty(SelectedShiftType))" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">End Time</label>
                        <input type="time" class="form-input" @bind="ShiftEndTime"
                               disabled="@(SelectedShiftType != "Custom" && !string.IsNullOrEmpty(SelectedShiftType))" />
                    </div>
                </div>
                
                <div class="form-group" style="margin-top:16px;">
                    <label class="form-label">Notes (Optional)</label>
                    <textarea class="form-input" rows="2" @bind="ShiftNotes" placeholder="Any additional notes..."></textarea>
                </div>
                
                <div style="display:flex; gap:12px; margin-top:24px;">
                    <button class="btn-primary" style="flex:1;" @onclick="SaveShift" disabled="@(IsSaving || string.IsNullOrEmpty(SelectedShiftType))">
                        @if (IsSaving)
                        {
                            <span>Saving...</span>
                        }
                        else
                        {
                            <span>💾 Save Shift</span>
                        }
                    </button>
                    <button class="btn-secondary" style="flex:1;" @onclick="CloseShiftModal">Cancel</button>
                </div>
            </div>
        </div>
    </div>
}

<!-- History Modal -->
@if (ShowHistoryModal)
{
    <div class="modal-overlay" @onclick="CloseHistoryModal">
        <div class="modal-content" style="max-width:900px;" @onclick:stopPropagation="true">
            <div class="modal-header-teal">
                <h2 style="margin:0; font-size:1.3rem;">Attendance History - @HistoryEmployeeName</h2>
            </div>
            
            <div style="padding:20px; max-height:60vh; overflow-y:auto;">
                @if (HistoryRecords.Any())
                {
                    <table class="user-table" style="font-size:0.9rem;">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Shift</th>
                                <th>Check In</th>
                                <th>Check Out</th>
                                <th>Hours</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var record in HistoryRecords)
                            {
                                <tr>
                                    <td style="font-weight:600;">@record.AttendanceDate.ToString("MMM dd, yyyy")</td>
                                    <td>
                                        @if (record.Schedule != null)
                                        {
                                            @($"{FormatTime(record.Schedule.ScheduledStart)} - {FormatTime(record.Schedule.ScheduledEnd)}")
                                        }
                                        else
                                        {
                                            <span style="color:#94a3b8;">N/A</span>
                                        }
                                    </td>
                                    <td>@(record.ActualCheckIn?.ToString("hh:mm tt") ?? "--:--")</td>
                                    <td>@(record.ActualCheckOut?.ToString("hh:mm tt") ?? "--:--")</td>
                                    <td style="font-weight:700; color:#10b981;">@((record.RegularHours + record.OvertimeHours).ToString("F1"))h</td>
                                    <td>
                                        <span class="status-badge status-@record.AttendanceStatus.ToLower().Replace(" ", "-")">
                                            @record.AttendanceStatus
                                        </span>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <div class="no-data">No attendance history found</div>
                }
            </div>
            
            <div class="action-footer">
                <button class="btn-secondary" @onclick="CloseHistoryModal">Close</button>
            </div>
        </div>
    </div>
}

<style>
    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .stat-title {
        font-size: 0.85rem;
        color: #64748b;
        text-transform: uppercase;
        font-weight: 600;
    }
    .stat-value {
        font-size: 2rem;
        font-weight: 900;
        margin-top: 8px;
    }
    .shift-badge {
        padding: 4px 10px;
        border-radius: 8px;
        font-size: 0.8rem;
        font-weight: 600;
    }
    .shift-day {
        background-color: #fef3c7;
        color: #92400e;
    }
    .shift-night {
        background-color: #e0e7ff;
        color: #3730a3;
    }
    .status-badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 600;
    }
    .status-present {
        background-color: #d1fae5;
        color: #065f46;
    }
    .status-absent, .status-no-shift {
        background-color: #fee2e2;
        color: #991b1b;
    }
    .status-on-leave {
        background-color: #fef3c7;
        color: #92400e;
    }
    .status-pending {
        background-color: #f1f5f9;
        color: #64748b;
    }
    .btn-checkin {
        background: #10b981;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
    }
    .btn-checkout {
        background: #f59e0b;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
    }
    .btn-icon {
        padding: 6px 8px;
        border: none;
        border-radius: 6px;
        font-size: 1rem;
        cursor: pointer;
        min-width: 36px;
        height: 36px;
    }
    .btn-edit {
        background: #6366f1;
        color: white;
    }
    .btn-history {
        background: #64748b;
        color: white;
    }
</style>

@code {
    private List<Employee> AllEmployees = new();
    private List<Schedule> ScheduleRecords = new();
    private List<AttendanceModel> AttendanceRecords = new();
    private List<AttendanceModel> HistoryRecords = new();
    
    private string SearchText = "";
    private DateTime SelectedDate = DateTime.Today;
    
    private bool IsLoaded = false;
    private bool HasError = false;
    private string ErrorMessage = "";
    private bool ShowShiftModal = false;
    private bool ShowHistoryModal = false;
    private bool IsEditingShift = false;
    private bool IsSaving = false;
    
    // Summary
    private int PresentCount = 0;
    private int AbsentCount = 0;
    private int OnLeaveCount = 0;
    private int LateCount = 0;
    
    // Modal fields
    private Employee? SelectedEmployee;
    private Schedule? SelectedSchedule;
    private string ModalEmployeeName = "";
    private string ModalEmployeeDept = "";
    private string SelectedShiftType = "";
    private DateTime ShiftStartTime = DateTime.Today.AddHours(5);
    private DateTime ShiftEndTime = DateTime.Today.AddHours(17);
    private string ShiftNotes = "";
    private string HistoryEmployeeName = "";
    
    private List<Employee> FilteredEmployees
    {
        get
        {
            var list = AllEmployees.Where(e => e.Status == "Active").ToList();
            
            if (!string.IsNullOrWhiteSpace(SearchText))
            {
                var search = SearchText.Trim();
                list = list.Where(e =>
                    (e.FirstName + " " + e.LastName).Contains(search, StringComparison.OrdinalIgnoreCase) ||
                    e.EmployeeID.ToString().Contains(search) ||
                    (e.Position?.Department?.DepartmentName ?? "").Contains(search, StringComparison.OrdinalIgnoreCase))
                    .ToList();
            }
            
            return list.OrderBy(e => e.FirstName).ThenBy(e => e.LastName).ToList();
        }
    }
    
    protected override async Task OnInitializedAsync()
    {
        await LoadData();
    }
    
    private async Task LoadData()
    {
        try
        {
            HasError = false;
            ErrorMessage = "";
            
            // Load employees (same pattern as EmployeeManagement)
            AllEmployees = await Context.Employees
                .Include(e => e.Position)
                    .ThenInclude(p => p!.Department)
                .AsNoTracking()
                .OrderBy(e => e.FirstName)
                .ToListAsync();
            
            // Load schedules for selected date
            ScheduleRecords = await Context.Schedules
                .Where(s => s.ScheduleDate.Date == SelectedDate.Date && s.IsActive)
                .AsNoTracking()
                .ToListAsync();
            
            // Load attendance for selected date
            AttendanceRecords = await Context.Attendances
                .Where(a => a.AttendanceDate.Date == SelectedDate.Date)
                .Include(a => a.Schedule)
                .AsNoTracking()
                .ToListAsync();
            
            CalculateSummary();
            IsLoaded = true;
        }
        catch (Exception ex)
        {
            HasError = true;
            ErrorMessage = ex.Message;
            IsLoaded = true;
        }
    }
    
    private async Task RetryLoad()
    {
        IsLoaded = false;
        StateHasChanged();
        await Task.Delay(500);
        await LoadData();
    }
    
    private void CalculateSummary()
    {
        PresentCount = AttendanceRecords.Count(a => a.AttendanceStatus == "Present");
        AbsentCount = AttendanceRecords.Count(a => a.AttendanceStatus == "Absent");
        OnLeaveCount = AttendanceRecords.Count(a => a.AttendanceStatus == "On Leave");
        
        // Calculate late count dynamically
        LateCount = 0;
        foreach (var att in AttendanceRecords.Where(a => a.ActualCheckIn.HasValue))
        {
            var schedule = ScheduleRecords.FirstOrDefault(s => s.EmployeeID == att.EmployeeID);
            if (schedule != null && IsEmployeeLate(att, schedule))
            {
                LateCount++;
            }
        }
    }
    
    // Calculate late dynamically - check-in > scheduled start + 15 minutes
    private bool IsEmployeeLate(AttendanceModel? attendance, Schedule? schedule)
    {
        if (attendance?.ActualCheckIn == null || schedule == null) return false;
        
        var checkInTime = attendance.ActualCheckIn.Value.TimeOfDay;
        var graceTime = schedule.ScheduledStart.Add(TimeSpan.FromMinutes(15));
        
        return checkInTime > graceTime;
    }
    
    private void OnSearchChanged(ChangeEventArgs e)
    {
        SearchText = e.Value?.ToString() ?? "";
        StateHasChanged();
    }
    
    private async Task OnDateChanged(ChangeEventArgs e)
    {
        if (DateTime.TryParse(e.Value?.ToString(), out var date))
        {
            SelectedDate = date;
            await LoadData();
        }
    }
    
    private async Task LoadToday()
    {
        SelectedDate = DateTime.Today;
        await LoadData();
    }
    
    private void OpenShiftModal(Employee emp, Schedule? schedule)
    {
        SelectedEmployee = emp;
        SelectedSchedule = schedule;
        IsEditingShift = schedule != null;
        ModalEmployeeName = $"{emp.FirstName} {emp.LastName}";
        ModalEmployeeDept = emp.Position?.Department?.DepartmentName ?? "-";
        
        if (schedule != null)
        {
            var startHour = schedule.ScheduledStart.Hours;
            var endHour = schedule.ScheduledEnd.Hours;
            
            if (startHour == 5 && endHour == 17)
                SelectedShiftType = "Day";
            else if (startHour == 17 && endHour == 5)
                SelectedShiftType = "Night";
            else
                SelectedShiftType = "Custom";
            
            ShiftStartTime = DateTime.Today.Add(schedule.ScheduledStart);
            ShiftEndTime = DateTime.Today.Add(schedule.ScheduledEnd);
            ShiftNotes = schedule.Notes ?? "";
        }
        else
        {
            SelectedShiftType = "";
            ShiftStartTime = DateTime.Today.AddHours(5);
            ShiftEndTime = DateTime.Today.AddHours(17);
            ShiftNotes = "";
        }
        
        ShowShiftModal = true;
    }
    
    private void OnShiftTypeChanged()
    {
        switch (SelectedShiftType)
        {
            case "Day":
                ShiftStartTime = DateTime.Today.AddHours(5);
                ShiftEndTime = DateTime.Today.AddHours(17);
                break;
            case "Night":
                ShiftStartTime = DateTime.Today.AddHours(17);
                ShiftEndTime = DateTime.Today.AddHours(5);
                break;
        }
    }
    
    private async Task SaveShift()
    {
        if (SelectedEmployee == null || string.IsNullOrEmpty(SelectedShiftType)) return;
        
        IsSaving = true;
        StateHasChanged();
        
        try
        {
            var startTimeSpan = ShiftStartTime.TimeOfDay;
            var endTimeSpan = ShiftEndTime.TimeOfDay;
            
            if (SelectedSchedule != null)
            {
                // Update existing schedule
                var existing = await Context.Schedules.FindAsync(SelectedSchedule.ScheduleID);
                if (existing != null)
                {
                    existing.ScheduledStart = startTimeSpan;
                    existing.ScheduledEnd = endTimeSpan;
                    existing.Notes = ShiftNotes;
                    existing.UpdatedAt = DateTime.Now;
                    Context.Schedules.Update(existing);
                }
            }
            else
            {
                // Create new schedule
                var newSchedule = new Schedule
                {
                    EmployeeID = SelectedEmployee.EmployeeID,
                    ScheduleDate = SelectedDate,
                    ScheduledStart = startTimeSpan,
                    ScheduledEnd = endTimeSpan,
                    IsActive = true,
                    Notes = ShiftNotes,
                    CreatedAt = DateTime.Now,
                    UpdatedAt = DateTime.Now
                };
                Context.Schedules.Add(newSchedule);
            }
            
            await Context.SaveChangesAsync();
            await LoadData();
            CloseShiftModal();
        }
        catch (Exception ex)
        {
            await JSRuntime.InvokeVoidAsync("alert", $"Error saving shift: {ex.Message}");
        }
        finally
        {
            IsSaving = false;
        }
    }
    
    private void CloseShiftModal()
    {
        ShowShiftModal = false;
        SelectedEmployee = null;
        SelectedSchedule = null;
    }
    
    private async Task CheckIn(Employee emp, Schedule schedule)
    {
        try
        {
            // Check if attendance already exists
            var existingAttendance = AttendanceRecords.FirstOrDefault(a => a.EmployeeID == emp.EmployeeID);
            
            if (existingAttendance != null)
            {
                // Update existing
                var toUpdate = await Context.Attendances.FindAsync(existingAttendance.AttendanceID);
                if (toUpdate != null)
                {
                    toUpdate.ActualCheckIn = DateTime.Now;
                    toUpdate.AttendanceStatus = "Present";
                    toUpdate.UpdatedAt = DateTime.Now;
                    Context.Attendances.Update(toUpdate);
                }
            }
            else
            {
                // Create new attendance record
                var newAttendance = new AttendanceModel
                {
                    EmployeeID = emp.EmployeeID,
                    ScheduleID = schedule.ScheduleID,
                    AttendanceDate = SelectedDate,
                    ActualCheckIn = DateTime.Now,
                    AttendanceStatus = "Present",
                    CreatedAt = DateTime.Now,
                    UpdatedAt = DateTime.Now
                };
                Context.Attendances.Add(newAttendance);
            }
            
            await Context.SaveChangesAsync();
            await LoadData();
        }
        catch (Exception ex)
        {
            await JSRuntime.InvokeVoidAsync("alert", $"Error: {ex.Message}");
        }
    }
    
    private async Task CheckOut(AttendanceModel attendance)
    {
        try
        {
            var existing = await Context.Attendances.FindAsync(attendance.AttendanceID);
            if (existing != null)
            {
                existing.ActualCheckOut = DateTime.Now;
                
                // Calculate hours
                if (existing.ActualCheckIn.HasValue)
                {
                    var hours = (DateTime.Now - existing.ActualCheckIn.Value).TotalHours;
                    existing.RegularHours = (decimal)Math.Min(hours, 8);
                    existing.OvertimeHours = (decimal)Math.Max(hours - 8, 0);
                }
                
                existing.UpdatedAt = DateTime.Now;
                Context.Attendances.Update(existing);
                await Context.SaveChangesAsync();
                await LoadData();
            }
        }
        catch (Exception ex)
        {
            await JSRuntime.InvokeVoidAsync("alert", $"Error: {ex.Message}");
        }
    }
    
    private async Task ViewHistory(int employeeId)
    {
        var emp = AllEmployees.FirstOrDefault(e => e.EmployeeID == employeeId);
        if (emp == null) return;
        
        HistoryEmployeeName = $"{emp.FirstName} {emp.LastName}";
        HistoryRecords = await Context.Attendances
            .Where(a => a.EmployeeID == employeeId)
            .Include(a => a.Schedule)
            .OrderByDescending(a => a.AttendanceDate)
            .Take(30)
            .AsNoTracking()
            .ToListAsync();
        
        ShowHistoryModal = true;
    }
    
    private void CloseHistoryModal()
    {
        ShowHistoryModal = false;
        HistoryRecords = new();
    }
    
    private string FormatTime(TimeSpan time)
    {
        return DateTime.Today.Add(time).ToString("hh:mm tt");
    }
    
    private string GetShiftName(int hour)
    {
        return hour >= 5 && hour < 17 ? "Day Shift" : "Night Shift";
    }
    
    private string GetShiftClass(int hour)
    {
        return hour >= 5 && hour < 17 ? "shift-day" : "shift-night";
    }
    
    private string GetStatusText(AttendanceModel? attendance, Schedule? schedule)
    {
        if (attendance != null) return attendance.AttendanceStatus;
        if (schedule != null) return "Pending";
        return "No Shift";
    }
    
    private string GetStatusClass(AttendanceModel? attendance, Schedule? schedule)
    {
        if (attendance != null) return attendance.AttendanceStatus.ToLower().Replace(" ", "-");
        if (schedule != null) return "pending";
        return "no-shift";
    }
}
