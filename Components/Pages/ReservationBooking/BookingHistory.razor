@page "/reservations/booking-history"
@inject NavigationManager Navigation
@layout MainLayout

<div class="page-wrapper">
    <header class="page-topbar">
        <h1>Booking History</h1>
        <span class="page-topbar-date">@DateTime.Now.ToString("dddd, MMMM dd, yyyy")</span>
    </header>

    <section class="page-content">
    <div class="toolbar-container" style="margin-bottom: 20px;">
        <div class="search-box">
            <input type="text" placeholder="Search by guest name or booking ID..." @bind="SearchText" />
            <span class="search-icon">🔍</span>
        </div>
        <select class="filter-select" @bind="SelectedStatus">
            <option value="">All Status</option>
            <option value="Confirmed">Confirmed</option>
            <option value="Checked-In">Checked-In</option>
            <option value="Checked-Out">Checked-Out</option>
            <option value="Cancelled">Cancelled</option>
        </select>
    </div>

    <div class="panel-card">
        <div class="panel-body">
            <div class="booking-table-wrapper">
                <table class="booking-table">
                    <thead>
                        <tr>
                            <th>Booking ID</th>
                            <th>Guest Name</th>
                            <th>Room</th>
                            <th>Check‑In</th>
                            <th>Check‑Out</th>
                            <th>Status</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var booking in FilteredBookings)
                        {
                            <tr>
                                <td class="booking-id">@booking.Id</td>
                                <td>@booking.GuestName</td>
                                <td>@booking.Room</td>
                                <td>@booking.CheckIn.ToString("MMM dd, yyyy")</td>
                                <td>@booking.CheckOut.ToString("MMM dd, yyyy")</td>
                                <td><span class="status-badge @booking.StatusClass">@booking.Status</span></td>
                                <td class="amount">@booking.Total.ToString("C")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="pagination">
                <button class="pagination-btn" disabled="@(CurrentPage == 1)" @onclick="() => ChangePage(-1)">Previous</button>
                <span class="pagination-info">Page @CurrentPage of @TotalPages</span>
                <button class="pagination-btn" disabled="@(CurrentPage == TotalPages)" @onclick="() => ChangePage(1)">Next</button>
            </div>
        </div>
    </div>
    </section>
</div>

@code {
    private string SearchText { get; set; } = "";
    private string SelectedStatus { get; set; } = "";
    private int CurrentPage = 1;
    private const int PageSize = 10;

    private List<Booking> AllBookings = new()
    {
        new() { Id = "BK001", GuestName = "Alice Chen", Room = "101", CheckIn = new DateOnly(2025, 1, 5), CheckOut = new DateOnly(2025, 1, 7), Status = "Confirmed", Total = 350.00m },
        new() { Id = "BK002", GuestName = "Ben Carter", Room = "203", CheckIn = new DateOnly(2025, 1, 6), CheckOut = new DateOnly(2025, 1, 10), Status = "Checked-In", Total = 820.00m },
        new() { Id = "BK003", GuestName = "Clara Wu", Room = "305", CheckIn = new DateOnly(2025, 1, 4), CheckOut = new DateOnly(2025, 1, 6), Status = "Checked-Out", Total = 540.00m },
        new() { Id = "BK004", GuestName = "David Lee", Room = "112", CheckIn = new DateOnly(2025, 1, 9), CheckOut = new DateOnly(2025, 1, 12), Status = "Cancelled", Total = 600.00m },
        new() { Id = "BK005", GuestName = "Eve Martinez", Room = "210", CheckIn = new DateOnly(2025, 1, 11), CheckOut = new DateOnly(2025, 1, 14), Status = "Confirmed", Total = 720.00m },
        new() { Id = "BK006", GuestName = "Frank O'Neil", Room = "401", CheckIn = new DateOnly(2025, 1, 12), CheckOut = new DateOnly(2025, 1, 15), Status = "Confirmed", Total = 960.00m },
    };

    private List<Booking> FilteredBookings =>
        AllBookings
            .Where(b =>
                (string.IsNullOrEmpty(SearchText) ||
                 b.GuestName.Contains(SearchText, StringComparison.OrdinalIgnoreCase) ||
                 b.Id.Contains(SearchText, StringComparison.OrdinalIgnoreCase))
                && (string.IsNullOrEmpty(SelectedStatus) || b.Status == SelectedStatus))
            .Skip((CurrentPage - 1) * PageSize)
            .Take(PageSize)
            .ToList();

    private int TotalPages => (int)Math.Ceiling((double)
        AllBookings.Count(b =>
            (string.IsNullOrEmpty(SearchText) ||
             b.GuestName.Contains(SearchText, StringComparison.OrdinalIgnoreCase) ||
             b.Id.Contains(SearchText, StringComparison.OrdinalIgnoreCase))
            && (string.IsNullOrEmpty(SelectedStatus) || b.Status == SelectedStatus))
        / PageSize);

    private void ChangePage(int delta)
    {
        CurrentPage = Math.Max(1, Math.Min(TotalPages, CurrentPage + delta));
    }

    public class Booking
    {
        public string Id { get; set; } = "";
        public string GuestName { get; set; } = "";
        public string Room { get; set; } = "";
        public DateOnly CheckIn { get; set; }
        public DateOnly CheckOut { get; set; }
        public string Status { get; set; } = "";
        public decimal Total { get; set; }

        public string StatusClass => Status switch
        {
            "Confirmed" => "status-confirmed",
            "Checked-In" => "status-checked-in",
            "Checked-Out" => "status-checked-out",
            "Cancelled" => "status-cancelled",
            _ => ""
        };
    }
}