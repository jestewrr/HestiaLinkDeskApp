@page "/login"
@using HestiaLink.Components.Layout
@using HestiaLink.Services
@layout LoginLayout
@inject NavigationManager Navigation
@inject UserSession UserSession

<div class="login-page-background">
    <div class="login-card">

        <div class="header-section">
            <h1>HestiaLink Hospitality ERP System</h1>
            <div class="logo-placeholder">
                <img src="/images/hestialogo.png" alt="HestiaLink Logo" />
            </div>
        </div>

        <div class="input-group">
            <label for="username">Username</label>
            <div class="input-container">
                <span class="icon icon-email"></span>
                <input id="username" placeholder="Enter username (e.g. hr, stock, admin)" @bind="Username" />
            </div>
        </div>

        <div class="input-group">
            <label for="password">Password</label>
            <div class="input-container">
                <span class="icon icon-lock"></span>
                <input id="password" type="@(ShowPassword ? "text" : "password")" placeholder="Enter password (1234)" @bind="Password" />
                <span class="eye-icon" @onclick="TogglePasswordVisibility"></span>
            </div>
        </div>

        <button class="login-button" @onclick="HandleLogin">Login</button>

        @if (!string.IsNullOrEmpty(Message))
        {
            <p class="error-message" style="color: #b91c1c; margin-top: 15px; font-weight: 600;">@Message</p>
        }

        <div style="margin-top: 20px; font-size: 0.8rem; color: #666;">
            <strong>Try these:</strong><br />
            admin / 1234 (Full Access)<br />
            hr / 1234 (HR Only)<br />
            stock / 1234 (Inventory Only)<br />
            front / 1234 (Reservations Only)
        </div>
    </div>
</div>

@code {
    private string Username { get; set; } = "";
    private string Password { get; set; } = "";
    private string Message { get; set; } = "";
    private bool ShowPassword { get; set; } = false;

    private void HandleLogin()
    {
        if (string.IsNullOrWhiteSpace(Username) || string.IsNullOrWhiteSpace(Password))
        {
            Message = "Please enter credentials.";
            return;
        }

        if (Password == "1234")
        {
            // ROUTING LOGIC BASED ON ROLE
            switch (Username.ToLower())
            {
                case "admin":
                    UserSession.SetUser("Administrator", "Administrator");
                    Navigation.NavigateTo("/dashboard");
                    break;
                case "hr":
                    UserSession.SetUser("HR Manager", "HR");
                    Navigation.NavigateTo("/hr/employee-management"); // Jump straight to HR
                    break;
                case "stock":
                    UserSession.SetUser("Stock Clerk", "Inventory");
                    Navigation.NavigateTo("/inventory/stock-management"); // Jump straight to Inventory
                    break;
                case "front":
                    UserSession.SetUser("Front Desk", "FrontDesk");
                    Navigation.NavigateTo("/reservations/booking-history"); // Jump straight to Booking
                    break;
                default:
                    Message = "Invalid username. Try admin, hr, stock, or front.";
                    break;
            }
        }
        else
        {
            Message = "Invalid password. (Use 1234)";
        }
    }

    private void TogglePasswordVisibility()
    {
        ShowPassword = !ShowPassword;
    }
}